<div class="container my-2">
  <div class="row d-flex justify-content-center">
    <div class="row d-flex justify-content-center">
      <div class="col-12 col-md-8 text-center">
        <h2 class="fw-bold text-muted">Death Notice Entry Form</h2>
        <small>
          Please fill out the form below to submit a death notice. Fields marked
          with an asterisk (<span class="text-danger fw-bold">*</span>) are
          required.
        </small>
      </div>
    </div>
    <div class="col-12">
      <form
        #noticeForm="ngForm"
        class="d-flex flex-column justify-content-center"
      >
        <section class="">
          <app-image-upload />
        </section>

        <section class="mt-5">
          <div class="row d-flex justify-content-center">
            <div class="col-12 col-lg-8">
              <div class="row d-none d-lg-flex">
                <div class="col-6 col-lg-4">
                  <label class="col-form-label"
                    ><strong
                      ><span style="color: rgb(0, 0, 0)"
                        >Name <span class="text-danger">*</span></span
                      ></strong
                    ></label
                  >
                </div>
                <div class="col-6 col-lg-4">
                  <label class="col-form-label"
                    ><strong
                      ><span style="color: rgb(0, 0, 0)"
                        >Date of Birth</span
                      ></strong
                    ></label
                  >
                </div>
                <div class="col-6 col-lg-4">
                  <label class="col-form-label"
                    ><strong
                      ><span style="color: rgb(0, 0, 0)"
                        >Date of Death <span class="text-danger">*</span></span
                      ></strong
                    ></label
                  >
                </div>
              </div>
              <div class="row mb-3">
                <div class="col-12 col-lg-4 mb-3 mb-lg-0">
                  <label class="form-label d-lg-none me-2"
                    ><strong
                      ><span class="w-100" style="color: rgb(0, 0, 0)"
                        >Name: <span class="text-danger">*</span></span
                      ></strong
                    ></label
                  ><input
                    class="form-control"
                    type="text"
                    name="noticeName"
                    [(ngModel)]="noticeEntryModel.name"
                    required
                    #nameCtrl="ngModel"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px; width: 100%"
                  />
                </div>
                <div class="col-12 col-lg-4 mb-3 mb-lg-0">
                  <label class="form-label d-lg-none me-2"
                    ><strong
                      ><span style="color: rgb(0, 0, 0)"
                        >Date of Birth:</span
                      ></strong
                    ></label
                  ><input
                    class="form-control"
                    type="date"
                    style="border-width: 1.8px"
                    title="Select bith date"
                    name="birth_date"
                    [(ngModel)]="noticeEntryModel.birth_date"
                    #birth_date="ngModel"
                    (change)="saveNoticeData()"
                  />
                </div>
                <div class="col-12 col-lg-4 mb-3 mb-lg-0">
                  <label class="form-label d-lg-none me-2"
                    ><strong
                      ><span style="color: rgb(0, 0, 0)"
                        >Date of Death <span class="text-danger">*</span></span
                      ></strong
                    ></label
                  ><input
                    class="form-control"
                    type="date"
                    name="death_date"
                    [(ngModel)]="noticeEntryModel.death_date"
                    #death_date="ngModel"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>
              </div>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="d-flex justify-content-center">
            <div class="col-12 col-md-8">
              <label class="form-label fw-bold" style="font-size: 18px"
                >Enter Death Announcement:
                <span class="text-danger">*</span></label
              ><textarea
                class="form-control"
                style="border-width: 1.8px"
                rows="15"
                name="announcement"
                [(ngModel)]="noticeEntryModel.announcement"
                #announcement="ngModel"
                (selectionchange)="saveNoticeData()"
                sel
              ></textarea>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="row d-flex justify-content-center">
            <div class="col-6">
              <div class="col-12 mb-2">
                <label class="form-label fw-bold" style="font-size: 18px"
                  >Events:</label
                ><small class="ms-2">(Wake, burial, repast, etc.)</small>
              </div>

              <div
                class="row mb-3 p-1"
                style="border: 2px solid #ddd"
                *ngFor="let event of noticeEntryModel.events; let i = index"
              >
                <div class="col-12 mb-2">
                  <label class="form-label"><strong>Type:</strong></label>
                  <input
                    class="form-control"
                    type="text"
                    [(ngModel)]="event.type"
                    name="event.type{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-labele"><strong>Date:</strong></label>
                  <input
                    class="form-control"
                    type="date"
                    [(ngModel)]="event.date"
                    name="event.date{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-label"><strong>Time:</strong></label>
                  <input
                    class="form-control"
                    type="time"
                    [(ngModel)]="event.time"
                    name="event.time{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-label"><strong>Location:</strong></label>
                  <input
                    class="form-control"
                    type="text"
                    [(ngModel)]="event.location"
                    name="event.location{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-label"><strong>Address:</strong></label>
                  <input
                    class="form-control"
                    type="text"
                    [(ngModel)]="event.address"
                    name="event.address{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-label"><strong>City:</strong></label>
                  <input
                    class="form-control"
                    type="text"
                    [(ngModel)]="event.city"
                    name="event.city{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 mb-2">
                  <label class="form-label"><strong>State:</strong></label>
                  <input
                    class="form-control"
                    type="text"
                    [(ngModel)]="event.state"
                    name="event.state{{ i }}"
                    (change)="saveNoticeData()"
                    style="border-width: 1.8px"
                  />
                </div>

                <div class="col-12 col-lg-1 d-flex align-items-end">
                  <button
                    type="button"
                    class="btn btn-danger"
                    (click)="removeEvent(i)"
                    *ngIf="noticeEntryModel.events.length > 1"
                  >
                    ✕
                  </button>
                </div>
              </div>

              <button
                type="button"
                class="btn btn-outline-primary mt-2"
                (click)="addEvent()"
              >
                + Add Another Event
              </button>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="row justify-content-center">
            <div class="col-12 col-md-6">
              <!-- Section title -->
              <div class="mb-2">
                <label class="form-label fw-bold" style="font-size: 18px">
                  Contact Information:
                </label>
              </div>

              <!-- Desktop headers -->
              <div class="row d-none d-lg-flex mb-2">
                <div class="col-lg-4">
                  <strong>Name: <span class="text-danger">*</span></strong>
                </div>
                <div class="col-lg-4"><strong>Relationship:</strong></div>
                <div class="col-lg-3">
                  <strong>Phone: <span class="text-danger">*</span></strong>
                </div>
                <div class="col-lg-1"></div>
              </div>

              <!-- Contact rows -->
              <div
                class="row mb-3 align-items-end"
                *ngFor="let contact of noticeEntryModel.contacts; let i = index"
              >
                <div class="col-12 col-lg-4 mb-2 mb-lg-0">
                  <label class="form-label d-lg-none"
                    ><strong
                      >Name: <span class="text-danger">*</span></strong
                    ></label
                  >
                  <input
                    class="form-control"
                    [(ngModel)]="contact.name"
                    (change)="saveNoticeData()"
                  />
                </div>

                <div class="col-12 col-lg-4 mb-2 mb-lg-0">
                  <label class="form-label d-lg-none"
                    ><strong>Relationship:</strong></label
                  >
                  <input
                    class="form-control"
                    [(ngModel)]="contact.relationship"
                    (change)="saveNoticeData()"
                  />
                </div>

                <div class="col-12 col-lg-3 mb-2 mb-lg-0">
                  <label class="form-label d-lg-none"
                    ><strong
                      >Phone: <span class="text-danger">*</span></strong
                    ></label
                  >
                  <input
                    class="form-control"
                    [(ngModel)]="contact.phone"
                    (change)="saveNoticeData()"
                  />
                </div>

                <div class="col-12 col-lg-1 d-flex justify-content-lg-end">
                  <button
                    class="btn btn-danger"
                    (click)="removeContact(i)"
                    *ngIf="noticeEntryModel.contacts.length > 1"
                  >
                    ✕
                  </button>
                </div>
              </div>

              <button
                class="btn btn-outline-primary mt-2"
                (click)="addContact()"
              >
                + Add Another Contact
              </button>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="row d-flex justify-content-center">
            <div class="col-12 col-md-6">
              <label class="form-label"
                ><strong
                  >Your Email: <span class="text-danger">*</span></strong
                ></label
              >
              <input
                class="form-control"
                [(ngModel)]="noticeEntryModel.email"
                (change)="saveNoticeData()"
              />
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="row d-flex justify-content-center">
            <div class="col-12 col-md-6">
              <label class="form-label fw-bold" style="font-size: 18px"
                >Groups:</label
              ><small class="ms-2">(optional)</small
              ><small class="d-block"
                >If the deceased was part of a group (school, work, family,
                etc.), you can select that group or add a new group. This will
                enable you to search for all members of that group who have
                passed. </small
              ><label
                class="form-label fw-bold mt-4 mb-0"
                style="font-size: 15px"
                >Select group(s):</label
              >
              <small class="ms-2"
                >(press ctrl then click for multiple selections)</small
              >

              <select
                class="form-select"
                multiple
                [(ngModel)]="selectedGroups"
                (click)="addDeceasedGroup()"
                (change)="saveNoticeData()"
              >
                <option *ngFor="let group of groups" [ngValue]="group">
                  {{ group.name }}
                </option>
              </select>

              <label
                class="form-label fw-bold mt-4 mb-0"
                style="font-size: 15px; font-weight: bold"
                >Create a new group:</label
              >

              <!-- Group name input -->
              <div
                class="col-12 col-lg-10 mb-2 mb-lg-0 d-flex flex-row align-items-center"
              >
                <input
                  class="form-control"
                  type="text"
                  [(ngModel)]="newGroup"
                  name="name"
                  style="border-width: 1.8px"
                />
                <button class="btn btn-outline-primary" (click)="addNewGroup()">
                  <small>Save</small>
                </button>
              </div>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="d-flex justify-content-center">
            <div class="col-12 col-md-8">
              <label class="form-label fw-bold" style="font-size: 18px"
                >Additional Information:</label
              ><textarea
                class="form-control"
                style="border-width: 1.8px"
                rows="15"
                name="additionalInformation"
                [(ngModel)]="noticeEntryModel.additionalInformation"
                #additionalInformation="ngModel"
                (selectionchange)="saveNoticeData()"
                sel
              ></textarea>
            </div>
          </div>
        </section>

        <section class="mt-5">
          <div class="row d-flex justify-content-center flex-column">
            <div class="col-12 col-md-6">
              <label class="form-label fw-bold" style="font-size: 18px"
                >Please choose a payment type:</label
              >
            </div>
            <div class="col-12 col-md-6">
              <div class="col">
                <div class="form-check" name="">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="formCheck-2"
                    value="PayPal"
                    name="paymentMethod"
                    [(ngModel)]="paymentType"
                    (change)="onPaymentTypeChange(); saveNoticeData()"
                  />
                  <label
                    class="form-check-label fw-bold"
                    for="formCheck-2"
                    style="font-style: italic"
                    >PayPal</label
                  >
                </div>
                <div class="form-check" name="">
                  <input
                    class="form-check-input"
                    type="radio"
                    id="formCheck-3"
                    value="CreditCard"
                    name="paymentMethod"
                    [(ngModel)]="paymentType"
                    (change)="onPaymentTypeCreditCard(); saveNoticeData()"
                  />
                  <label class="form-check-label fw-bold" for="formCheck-3"
                    >Credit Card</label
                  >
                </div>
              </div>
            </div>
          </div>
        </section>

        <ng-container *ngIf="paymentType === 'CreditCard'; else payWithPayPal">
          <section class="mt-5">
            <div class="row d-flex justify-content-center">
              <div class="col-12 col-md-6">
                <div class="col-12 col-md-4">
                  <label class="form-label fw-bold">Amount:</label>
                  <span class="fs-5 ms-2">{{ noticePrice | currency }}</span>
                </div>
                <h6 class="fw-bold">
                  Enter Credit Card Info <span class="text-danger">*</span>
                </h6>
                <div
                  id="card-element"
                  class="p-3 border rounded"
                  style="border: 1px solid gray !important"
                ></div>
              </div>
            </div>

            <div class="row mt-2 d-flex justify-content-center">
              <div class="col-12 col-md-4">
                <button
                  class="btn btn-primary px-4 py-2"
                  type="button"
                  (click)="submitNotice()"
                  [disabled]="!noticeForm.valid"
                >
                  Submit Death Notice
                </button>
                <!-- [disabled]="!noticeForm.valid || !clientSecret" -->
              </div>
            </div>
          </section>
        </ng-container>

        <ng-template #payWithPayPal>
          <section class="mt-5">
            <div class="row d-flex justify-content-center">
              <div class="col-12 col-md-6">
                <div class="row mb-4">
                  <div class="col col-md-6">
                    <app-paypal-button />
                  </div>
                </div>
              </div>
            </div>
          </section>
        </ng-template>
      </form>
    </div>
  </div>
</div>
