<div class="container my-4">
  <form #noticeForm="ngForm">
    <!-- HEADER -->
    <section class="mb-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8 text-center">
          <h2 class="fw-bold text-muted">Death Notice Entry Form</h2>
          <small class="text-muted">
            Please fill out the form below to submit a death notice. Fields
            marked with an asterisk (<span class="text-danger fw-bold">*</span>)
            are required.
          </small>
        </div>
      </div>
    </section>

    <!-- IMAGE UPLOAD -->
    <section class="mt-4">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <app-image-upload />
        </div>
      </div>
    </section>

    <!-- NAME / DATES -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <div class="row d-none d-lg-flex mb-2">
            <div class="col-lg-4 fw-bold">
              Name <span class="text-danger">*</span>
            </div>
            <div class="col-lg-4 fw-bold">Date of Birth</div>
            <div class="col-lg-4 fw-bold">
              Date of Death <span class="text-danger">*</span>
            </div>
          </div>

          <div class="row">
            <div class="col-12 col-lg-4 mb-3">
              <label class="d-lg-none fw-bold">
                Name <span class="text-danger">*</span>
              </label>
              <input
                class="form-control"
                name="noticeName"
                [(ngModel)]="noticeEntryModel.name"
                required
                (change)="saveNoticeData()"
              />
            </div>

            <div class="col-12 col-lg-4 mb-3">
              <label class="d-lg-none fw-bold">Date of Birth</label>
              <input
                class="form-control"
                type="date"
                name="birth_date"
                [(ngModel)]="noticeEntryModel.birth_date"
                (change)="saveNoticeData()"
              />
            </div>

            <div class="col-12 col-lg-4 mb-3">
              <label class="d-lg-none fw-bold">
                Date of Death <span class="text-danger">*</span>
              </label>
              <input
                class="form-control"
                type="date"
                name="death_date"
                [(ngModel)]="noticeEntryModel.death_date"
                required
                (change)="saveNoticeData()"
              />
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ANNOUNCEMENT -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="form-label fw-bold fs-5">
            Death Announcement <span class="text-danger">*</span>
          </label>
          <textarea
            class="form-control"
            rows="15"
            name="announcement"
            required
            [(ngModel)]="noticeEntryModel.announcement"
            (change)="saveNoticeData()"
          ></textarea>
        </div>
      </div>
    </section>

    <!-- EVENTS -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="fw-bold fs-5">Events</label>
          <small class="text-muted ms-2">(Wake, burial, repast, etc.)</small>

          <div
            class="border rounded p-3 mt-3"
            *ngFor="let event of noticeEntryModel.events; let i = index"
          >
            <div class="row g-3">
              <div class="col-12 col-md-6">
                <label class="fw-bold">Type</label>
                <input
                  class="form-control"
                  [(ngModel)]="event.type"
                  name="eventType{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-6">
                <label class="fw-bold">Date</label>
                <input
                  type="date"
                  class="form-control"
                  [(ngModel)]="event.date"
                  name="eventDate{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-6">
                <label class="fw-bold">Time</label>
                <input
                  type="time"
                  class="form-control"
                  [(ngModel)]="event.time"
                  name="eventTime{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-6">
                <label class="fw-bold">Location</label>
                <input
                  class="form-control"
                  [(ngModel)]="event.location"
                  name="eventLocation{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-6">
                <label class="fw-bold">Address</label>
                <input
                  class="form-control"
                  [(ngModel)]="event.address"
                  name="eventAddress{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-6">
                <label class="fw-bold">City</label>
                <input
                  class="form-control"
                  [(ngModel)]="event.city"
                  name="eventCity{{ i }}"
                  (change)="saveNoticeData()"
                />
              </div>

              <div class="col-12 col-md-1 d-flex align-items-end">
                <button
                  class="btn btn-danger w-100"
                  type="button"
                  *ngIf="noticeEntryModel.events.length > 1"
                  (click)="removeEvent(i)"
                >
                  ✕
                </button>
              </div>
            </div>
          </div>

          <button
            type="button"
            class="btn btn-outline-primary mt-3"
            (click)="addEvent()"
          >
            + Add Another Event
          </button>
        </div>
      </div>
    </section>

    <!-- CONTACTS -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="fw-bold fs-5">Contact Information</label>

          <div
            class="row g-3 mt-3 align-items-end"
            *ngFor="let contact of noticeEntryModel.contacts; let i = index"
          >
            <div class="col-12 col-md-4">
              <label class="fw-bold">
                Name <span class="text-danger">*</span>
              </label>
              <input
                class="form-control"
                [(ngModel)]="contact.name"
                name="contactName{{ i }}"
                (change)="saveNoticeData()"
              />
            </div>

            <div class="col-12 col-md-4">
              <label class="fw-bold">Relationship</label>
              <input
                class="form-control"
                [(ngModel)]="contact.relationship"
                name="contactRelationship{{ i }}"
                (change)="saveNoticeData()"
              />
            </div>

            <div class="col-12 col-md-3">
              <label class="fw-bold">
                Phone <span class="text-danger">*</span>
              </label>
              <input
                class="form-control"
                [(ngModel)]="contact.phone"
                name="contactPhone{{ i }}"
                (change)="saveNoticeData()"
              />
            </div>

            <div class="col-12 col-md-1">
              <button
                class="btn btn-danger w-100"
                type="button"
                *ngIf="noticeEntryModel.contacts.length > 1"
                (click)="removeContact(i)"
              >
                ✕
              </button>
            </div>
          </div>

          <button
            type="button"
            class="btn btn-outline-primary mt-3"
            (click)="addContact()"
          >
            + Add Another Contact
          </button>
        </div>
      </div>
    </section>

    <!-- EMAIL -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="fw-bold fs-5">
            Your Email <span class="text-danger">*</span>
          </label>
          <input
            class="form-control"
            type="email"
            name="email"
            required
            [(ngModel)]="noticeEntryModel.email"
            (change)="saveNoticeData()"
          />
        </div>
      </div>
    </section>

    <!-- GROUPS -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="fw-bold fs-5">Groups</label>
          <small class="text-muted ms-2">(optional)</small>

          <p class="small text-muted mt-1">
            If the deceased was part of a group (school, work, family, etc.),
            you may select or create a group to enable group-based searches.
          </p>

          <label class="fw-bold mt-3">Select group(s)</label>
          <small class="ms-2">(Ctrl + click for multiple)</small>

          <select
            class="form-select mt-1"
            multiple
            [(ngModel)]="selectedGroups"
            (change)="addDeceasedGroup(); saveNoticeData()"
          >
            <option *ngFor="let group of groups" [ngValue]="group">
              {{ group.name }}
            </option>
          </select>

          <label class="fw-bold mt-4">Create a new group</label>

          <div class="row g-2 mt-1">
            <div class="col-12 col-md-9">
              <input
                class="form-control"
                [(ngModel)]="newGroup"
                name="newGroup"
              />
            </div>
            <div class="col-12 col-md-3">
              <button
                type="button"
                class="btn btn-outline-primary w-100"
                (click)="addNewGroup()"
              >
                Save
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- PAYMENT METHOD -->
    <section class="mt-5">
      <div class="row justify-content-center">
        <div class="col-12 col-lg-8">
          <label class="fw-bold fs-5">Payment Method</label>

          <div class="form-check mt-3">
            <input
              class="form-check-input"
              type="radio"
              value="PayPal"
              name="paymentMethod"
              [(ngModel)]="paymentType"
              (change)="onPaymentTypeChange(); saveNoticeData()"
            />
            <label class="form-check-label fw-bold fst-italic"> PayPal </label>
          </div>

          <div class="form-check mt-2">
            <input
              class="form-check-input"
              type="radio"
              value="CreditCard"
              name="paymentMethod"
              [(ngModel)]="paymentType"
              (change)="onPaymentTypeCreditCard(); saveNoticeData()"
            />
            <label class="form-check-label fw-bold"> Credit Card </label>
          </div>
        </div>
      </div>
    </section>

    <!-- CREDIT CARD -->
    <ng-container *ngIf="paymentType === 'CreditCard'">
      <section class="mt-5">
        <div class="row justify-content-center">
          <div class="col-12 col-lg-8">
            <div class="mb-2">
              <strong>Amount:</strong>
              <span class="fs-5 ms-2">
                {{ noticePrice | currency }}
              </span>
            </div>

            <h6 class="fw-bold">
              Enter Credit Card Info
              <span class="text-danger">*</span>
            </h6>

            <div id="card-element" class="p-3 border rounded mt-2"></div>

            <div class="mt-4">
              <button
                class="btn btn-primary px-5 py-2"
                type="button"
                (click)="submitNotice()"
                [disabled]="!noticeForm.valid"
              >
                Submit Death Notice
              </button>
            </div>
          </div>
        </div>
      </section>
    </ng-container>

    <!-- PAYPAL -->
    <ng-container *ngIf="paymentType === 'PayPal'">
      <section class="mt-5">
        <div class="row justify-content-center">
          <div class="col-12 col-md-6 col-lg-4">
            <app-paypal-button />
          </div>
        </div>
      </section>
    </ng-container>
  </form>
</div>
